
# Ensure unique PATH entries
typeset -U path PATH

# Root Directory Guard
# Prevents running shells from root to avoid cluttering the system root
if [[ "$PWD" == "/" ]]; then
  echo "Warning: Shell started in root. Switching to home directory."
  cd ~
fi

{{- if eq .chezmoi.os "darwin" }}
# macOS: iTerm2 shell integration
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

# Docker CLI completions (macOS)
fpath=({{ .chezmoi.homeDir }}/.docker/completions $fpath)
{{- end }}

# Shell completions
autoload -Uz compinit
compinit

# Homebrew (OS-specific paths)
{{- if eq .chezmoi.os "darwin" }}
{{- if eq .chezmoi.arch "arm64" }}
# macOS ARM64 (Apple Silicon)
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
export PATH="/opt/homebrew/opt/file-formula/bin:$PATH"
{{- else }}
# macOS Intel
export PATH="/usr/local/bin:/usr/local/sbin:$PATH"
{{- end }}
{{- else if eq .chezmoi.os "linux" }}
# Linux Homebrew
export PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"
{{- end }}

{{- if eq .chezmoi.os "darwin" }}
# Ruby (Homebrew - macOS)
export PATH="/opt/homebrew/opt/ruby/bin:/opt/homebrew/lib/ruby/gems/3.4.0/bin:$PATH"
export LDFLAGS="-L/opt/homebrew/opt/ruby/lib"
export CPPFLAGS="-I/opt/homebrew/opt/ruby/include"
export PKG_CONFIG_PATH="/opt/homebrew/opt/ruby/lib/pkgconfig"
{{- end }}

# Go
export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin

{{- if eq .chezmoi.os "darwin" }}
# Toolchains (External Volume - macOS only)
export PATH=$PATH:/Volumes/4444-iivii/ivi374forivi3ivi3/toolchains/bin
{{- end }}

# Gemini CLI Configuration
export GEMINI_CLI=1
if [ -f "$HOME/.config/op/secrets.zsh" ]; then
  source "$HOME/.config/op/secrets.zsh"
fi

# Google Cloud SDK
if [ -f '{{ .chezmoi.homeDir }}/google-cloud-sdk/path.zsh.inc' ]; then . '{{ .chezmoi.homeDir }}/google-cloud-sdk/path.zsh.inc'; fi
if [ -f '{{ .chezmoi.homeDir }}/google-cloud-sdk/completion.zsh.inc' ]; then . '{{ .chezmoi.homeDir }}/google-cloud-sdk/completion.zsh.inc'; fi

# pipx local bin
export PATH="$HOME/.local/bin:$PATH"

# Chezmoi aliases for dotfile management
alias cm='chezmoi'
alias cma='chezmoi apply'
alias cmd='chezmoi diff'
alias cme='chezmoi edit'
alias cmu='chezmoi update'
alias cms='chezmoi status'
alias cmcd='cd ~/.local/share/chezmoi'
alias cmpush='cd ~/.local/share/chezmoi && git push'
alias cmlog='cd ~/.local/share/chezmoi && git log --oneline -10'
