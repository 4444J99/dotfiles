# ─────────────────────────────────────────────────────────────────────────────
# Fish Shell Configuration - Managed by Chezmoi
# ─────────────────────────────────────────────────────────────────────────────

if status is-interactive
    # ─────────────────────────────────────────────────────────────────────────
    # PATH Configuration
    # ─────────────────────────────────────────────────────────────────────────

{{- if eq .chezmoi.os "darwin" }}
{{- if eq .chezmoi.arch "arm64" }}
    # macOS ARM64 (Apple Silicon) - Homebrew
    fish_add_path /opt/homebrew/bin
    fish_add_path /opt/homebrew/sbin
    fish_add_path /opt/homebrew/opt/file-formula/bin
{{- else }}
    # macOS Intel - Homebrew
    fish_add_path /usr/local/bin
    fish_add_path /usr/local/sbin
{{- end }}
{{- else if eq .chezmoi.os "linux" }}
    # Linux Homebrew
    fish_add_path /home/linuxbrew/.linuxbrew/bin
{{- end }}

{{- if eq .chezmoi.os "darwin" }}
    # Ruby (Homebrew - macOS)
    fish_add_path /opt/homebrew/opt/ruby/bin
    fish_add_path /opt/homebrew/lib/ruby/gems/3.4.0/bin
{{- end }}

    # Go
    set -gx GOPATH $HOME/go
    fish_add_path $GOPATH/bin

    # pipx local bin
    fish_add_path $HOME/.local/bin

{{- if eq .chezmoi.os "darwin" }}
    # Toolchains (External Volume - macOS only)
    if test -d /Volumes/4444-iivii/ivi374forivi3ivi3/toolchains/bin
        fish_add_path /Volumes/4444-iivii/ivi374forivi3ivi3/toolchains/bin
    end
{{- end }}

    # ─────────────────────────────────────────────────────────────────────────
    # Environment Variables
    # ─────────────────────────────────────────────────────────────────────────

    set -gx EDITOR nvim
    set -gx VISUAL nvim
    set -gx GEMINI_CLI 1

    # ─────────────────────────────────────────────────────────────────────────
    # 1Password Secrets
    # ─────────────────────────────────────────────────────────────────────────

    # Fish version of secrets loading (if you have a fish-compatible secrets file)
    if test -f $HOME/.config/op/secrets.fish
        source $HOME/.config/op/secrets.fish
    end

    # ─────────────────────────────────────────────────────────────────────────
    # Tool Initializations
    # ─────────────────────────────────────────────────────────────────────────

    # Starship prompt
    if command -q starship
        starship init fish | source
    end

    # Zoxide (smart cd)
    if command -q zoxide
        zoxide init fish | source
    end

    # fzf key bindings
    if command -q fzf
        fzf --fish | source

        # Use fd for fzf if available
        if command -q fd
            set -gx FZF_DEFAULT_COMMAND 'fd --type f --hidden --follow --exclude .git'
            set -gx FZF_CTRL_T_COMMAND $FZF_DEFAULT_COMMAND
            set -gx FZF_ALT_C_COMMAND 'fd --type d --hidden --follow --exclude .git'
        end

        set -gx FZF_DEFAULT_OPTS '--height 40% --layout=reverse --border --info=inline'
    end

    # Atuin (shell history)
    if command -q atuin
        atuin init fish | source
    end

    # direnv
    if command -q direnv
        direnv hook fish | source
    end

    # mise (auto-activates in fish per Homebrew)
    if command -q mise
        mise activate fish | source
    end

    # ─────────────────────────────────────────────────────────────────────────
    # Abbreviations (Fish's smart aliases)
    # ─────────────────────────────────────────────────────────────────────────

    # Git
    abbr -a g git
    abbr -a gs 'git status -sb'
    abbr -a gd 'git diff'
    abbr -a gds 'git diff --staged'
    abbr -a ga 'git add'
    abbr -a gaa 'git add -A'
    abbr -a gc 'git commit'
    abbr -a gcm 'git commit -m'
    abbr -a gca 'git commit --amend'
    abbr -a gco 'git checkout'
    abbr -a gcb 'git checkout -b'
    abbr -a gpl 'git pull --rebase'
    abbr -a gps 'git push'
    abbr -a gl 'git log --oneline --graph --decorate -20'
    abbr -a gst 'git stash'
    abbr -a gstp 'git stash pop'
    abbr -a gb 'git branch'

    # Chezmoi
    abbr -a cm chezmoi
    abbr -a cma 'chezmoi apply'
    abbr -a cmd 'chezmoi diff'
    abbr -a cme 'chezmoi edit'
    abbr -a cms 'chezmoi status'

    # Navigation
    abbr -a dl 'cd ~/Downloads'
    abbr -a dt 'cd ~/Desktop'
    abbr -a proj 'cd ~/Projects'

    # Tmux
    abbr -a tm tmux
    abbr -a tma 'tmux attach -t'
    abbr -a tmn 'tmux new -s'
    abbr -a tml 'tmux list-sessions'

    # ─────────────────────────────────────────────────────────────────────────
    # Aliases (for commands that should stay as-is)
    # ─────────────────────────────────────────────────────────────────────────

    # Modern CLI replacements
    if command -q eza
        alias ls 'eza --icons'
        alias ll 'eza -la --icons --git'
        alias la 'eza -a --icons'
        alias lt 'eza --tree --level=2 --icons'
    else
        alias ll 'ls -la'
        alias la 'ls -a'
    end

    if command -q bat
        alias cat 'bat --paging=never'
        alias catp bat
    end

    if command -q rg
        alias grep rg
    end

    # Python
    alias pip pip3

    # Homebrew maintenance
    alias brewup 'brew update && brew upgrade && brew cleanup && brew doctor'

    # Just
    if command -q just
        alias j just
    end

end
